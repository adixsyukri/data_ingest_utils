<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<workflow-app xmlns="uri:oozie:workflow:0.5" name="FULL-INGEST-DIRECT-WF-${source_name}-${schema}-${table}">
    <parameters>
        <property>
            <name>prefix</name>
            <value>/user/trace/source</value>
        </property>
    </parameters>
    <start to="removeExisting"/>
    <action name="removeExisting">
        <fs>
            <name-node>${nameNode}</name-node>
            <delete path="${prefix}/${source_name}/${schema}_${table}/CURRENT/"></delete>
        </fs>
        <ok to="sqoop"/>
        <error to="kill"/>
    </action>
    <action name="sqoop">
        <sqoop xmlns="uri:oozie:sqoop-action:0.3">
            <job-tracker>${resourceManager}</job-tracker>
            <name-node>${nameNode}</name-node>
            <job-xml>conf/oraoop-site.xml</job-xml>
            <arg>import</arg>
            <arg>-Dmapreduce.job.user.classpath.first=true</arg> 
            <arg>--connect</arg>
            <arg>${jdbc_uri}</arg>
            <arg>-m</arg>
            <arg>${mapper}</arg>
            <arg>--table</arg>
            <arg>${schema}.${table}</arg>
            <arg>--target-dir</arg>
            <arg>${prefix}/${source_name}/${schema}_${table}/CURRENT</arg>
            <arg>--delete-target-dir</arg>
            <arg>--username</arg>
            <arg>${username}</arg>
            <arg>--password</arg>
            <arg>${password}</arg>
            <arg>--as-parquetfile</arg>
            <arg>--direct</arg>
            <arg>--map-column-java</arg>
            <arg>${columns_java}</arg>
        </sqoop>
        <ok to="end"/>
        <error to="kill"/>
    </action>
<!--
    <action name="removeOldDistCP">
        <fs>
            <name-node>${nameNode}</name-node>
            <delete path="${prefix}/${source_name}/${schema}_${table}/CURRENT/"></delete>
        </fs>
        <ok to="sqoop"/>
        <error to="kill"/>
    </action>
    <action name="distcp">
        <distcp
            xmlns="uri:oozie:distcp-action:0.2">
            <job-tracker>${resourceManager}</job-tracker>
            <name-node>${nameNode}</name-node>
            <arg>${nameNode}/${prefix}/${source_name}/${schema}_${table}/CURRENT/</arg>
            <arg>${nameNode}/${prefix}/${source_name}/${schema}_${table}/${YEAR}-${MONTH}-${DAY}/</arg>
        </distcp>
        <ok to="end"/>
        <error to="kill"/>
    </action>-->
    <kill name="kill">
        <message>${wf:errorMessage(wf:lastErrorNode())}</message>
    </kill>
    <end name="end"/>
</workflow-app>
